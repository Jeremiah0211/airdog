<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" 
	xmlns:services="no.airdog.services.*"
    xmlns:view="no.airdog.view.*"
	xmlns:adminView="no.airdog.view.admin.*"
    creationComplete="init()" styleName="MainView"
    width="100%" height="100%" minWidth="800" minHeight="500"
    paddingBottom="0" paddingLeft="0" paddingRight="0" paddingTop="0"
    verticalGap="0" horizontalGap="0">
	<mx:Script>
        <![CDATA[
        	import mx.core.UIComponent;
        	import no.airdog.controller.Navigasjon;
            import no.airdog.services.Components;
        	import no.airdog.model.Bruker;
        	
            private function sok():void
			{
				visHundeliste();
				meny.selectedChild = brukermeny;
				Components.instance.controller.sokHund(sokefelt.text);
				sokeresultat.enabled = true;
			}
			
			private function visHjem():void
			{
				Navigasjon.visHjem();
				meny.selectedChild = brukermeny;
			}
            
            private function init():void
            {
				visHjem();
            }
            
            private function visLastOpp():void
            {
            	Navigasjon.visLastOpp();
            }
            
            private function visHundeliste():void
            {
            	Navigasjon.visHundeliste();
            }
            
            private function visAdminRoller():void
            {
            	Components.instance.controller.hentAlleRettigheter();
				Components.instance.controller.hentRollersRettigheter();
            	Navigasjon.visAdminRoller();
            }
            
            private function visAdminBackup():void
            {
            	Navigasjon.visAdminBackup();
            }
            
            private function visACL():void
            {
            	Navigasjon.visACL();
            }
            
            private function visArsgjennomsnitt():void
            {
            	Navigasjon.visArsgjennomsnitt();
            }
            
            private function visFiktivStamtre():void
            {
            	Navigasjon.visFiktivStamtre();
            }
            
            private function innloggingSprettOppVindu():void
            {
            	visHjem();
            	Components.instance.controller.loggUt();
            	Components.instance.controller.visLoggInnVindu(this);
            }
            
            private function leggInnJaktprove():void
            {
				Navigasjon.visJaktprove();
            }
            
            private function visStorHundeliste():void
			{
				Navigasjon.visStorHundeliste();
			}
			
			private function visLitenHundeliste():void
			{
				Navigasjon.visLitenHundeliste();
			}
			
			private function visAdminBrukere():void
			{
				Components.instance.controller.hentAlleBrukere();
				Components.instance.controller.hentRollersBrukere();
				Navigasjon.visAdminBrukere();
			}
			
			private function visHundprofil():void
			{
				Navigasjon.visHundprofil();
			}
			
			private function redigerBruker():void
			{
				var bruker:Bruker = new Bruker();
				bruker.epost = Components.instance.session.bruker.epost;
				bruker.fornavn = Components.instance.session.bruker.fornavn;
				bruker.etternavn = Components.instance.session.bruker.etternavn;
				bruker.passord = "";
				bruker.superadmin = Components.instance.session.bruker.superadmin;
				
				Components.instance.controller.visRedigerEgenBrukerVindu(UIComponent(this.parentApplication));
			}
        ]]>
    </mx:Script>
	   	
	<mx:VBox id="topbar" styleName="TopBar" width="100%" 
		paddingBottom="0" paddingLeft="0" paddingRight="0" paddingTop="0" verticalGap="0" horizontalGap="0">
		<mx:ApplicationControlBar width="100%" styleName="applicationBar">
			<mx:Image source="@Embed(source='/no/airdog/view/assets/airdoglogo28clean.png')" buttonMode="true" click="visHjem()"/>
			<mx:LinkButton label="AirDog" click="visHjem()" width="66"/>
			<mx:HBox styleName="sokBar">
				<mx:TextInput id="sokefelt" enter="sok()" styleName="sokFelt" minWidth="{Components.instance.session.bruker.rettigheter.administrere ? 200 : 300}"/>
				<mx:LinkButton label="Søk" styleName="sokKnapp" icon="@Embed(source='/no/airdog/view/assets/ikoner/magnifier.png')" click="sok()"/>
			</mx:HBox>
			
			<mx:LinkButton label="Bruker" icon="@Embed(source='/no/airdog/view/assets/ikoner/user.png')"
				click="{meny.selectedChild = brukermeny}"
				visible="{Components.instance.session.bruker.rettigheter.administrere}"/>
			<mx:LinkButton label="Admin" icon="@Embed(source='/no/airdog/view/assets/ikoner/crown.png')" 
				click="{meny.selectedChild = adminmeny}"
				visible="{Components.instance.session.bruker.rettigheter.administrere}"/>
			
			<mx:Spacer width="100%"/>
			<mx:LinkButton label="{Components.instance.session.bruker.epost}"
				buttonMode="{Components.instance.session.bruker.rettigheter.redigerEgenBruker}"
				enabled="{Components.instance.session.bruker.rettigheter.redigerEgenBruker}"
				click="redigerBruker()" /><mx:Label text="{Components.instance.session.bruker.sattKlubb}" fontSize="12"/>
			<mx:LinkButton label="Logg ut" click="innloggingSprettOppVindu()" icon="@Embed(source='/no/airdog/view/assets/ikoner/door_open_out.png')"/>
		</mx:ApplicationControlBar>
		
		<mx:ViewStack id="meny" width="100%" 
			paddingBottom="0" paddingLeft="0" paddingRight="0" paddingTop="0" verticalGap="0" horizontalGap="0">
			<mx:HBox id="brukermeny" label="Bruker" backgroundColor="#FFFFFF" borderStyle="solid" borderThickness="1" borderColor="#a3a3a3" 
				width="100%" verticalAlign="middle" paddingBottom="4" paddingTop="4" paddingLeft="4" paddingRight="4">
				<mx:LinkButton id="hjem" label="Hjem" click="visHjem()" styleName="UnderMeny"
					icon="@Embed(source='/no/airdog/view/assets/ikoner/home.png')" width="68"/>
				<mx:LinkButton id="sokeresultat" label="Søkeresultat" click="visHundeliste()" styleName="UnderMeny" 
					icon="@Embed(source='/no/airdog/view/assets/ikoner/dog_many.png')" enabled="false"/>
	   			<mx:LinkButton label="Aktiv hundprofil" styleName="UnderMeny" click="visHundprofil()"
	   				icon="@Embed(source='/no/airdog/view/assets/ikoner/dog.png')" 
	   				enabled="{Components.instance.session.hundprofil != null ? true : false}"
	   				toolTip="{Components.instance.session.hundprofil != null ? Components.instance.session.hundprofil.navn : ''}"/>
				<!-- nedprioritert
				<mx:LinkButton label="Favoritthunder" enabled="false" styleName="UnderMeny" 
					icon="@Embed(source='/no/airdog/view/assets/ikoner/star.png')"/>
				-->
				<mx:LinkButton label="Årsgjennomsnitt" styleName="UnderMeny" click="visArsgjennomsnitt()" 
					icon="@Embed(source='/no/airdog/view/assets/ikoner/calendar_month.png')"/>
				<mx:LinkButton label="Fiktivt stamtre" styleName="UnderMeny" click="visFiktivStamtre()" 
					icon="@Embed(source='/no/airdog/view/assets/ikoner/arrow_join_180.png')"/>
					<mx:Spacer width="100%"/>
				<mx:Image source="no/airdog/view/assets/ikoner/toggle.png" buttonMode="true"
					visible="{Components.instance.session.hovedNavigasjon.nr == 1 ? true : false}" click="visStorHundeliste()"/>
				<mx:Image source="no/airdog/view/assets/ikoner/toggle_collapse.png" buttonMode="true"
					visible="{Components.instance.session.hovedNavigasjon.nr == 1 ? true : false}" click="visLitenHundeliste()"/>
			</mx:HBox>
			<mx:HBox id="adminmeny" 
				enabled="{Components.instance.session.bruker.rettigheter.administrere}"
				label="Admin" backgroundColor="#FFFFFF" borderStyle="solid" 
				borderThickness="1" borderColor="#a3a3a3" width="100%" verticalAlign="middle" 
				paddingBottom="4" paddingTop="4" paddingLeft="4" paddingRight="4">
				<mx:LinkButton 
					visible="{Components.instance.session.bruker.rettigheter.klubbRolleBrukerHandtering}" 
					includeInLayout="{Components.instance.session.bruker.rettigheter.klubbRolleBrukerHandtering}" 
					label="Brukere" click="visAdminBrukere()" styleName="UnderMeny" icon="@Embed(source='/no/airdog/view/assets/ikoner/users.png')"/>
				<mx:LinkButton 
					visible="{Components.instance.session.bruker.rettigheter.rolleRettighetHandtering}" 
					includeInLayout="{Components.instance.session.bruker.rettigheter.rolleRettighetHandtering}" 
					label="Roller" click="visAdminRoller()" styleName="UnderMeny" 
					icon="@Embed(source='/no/airdog/view/assets/ikoner/cards_address.png')"/>
		 		<mx:LinkButton 
		 			visible="{Components.instance.session.bruker.rettigheter.importerDatabase}" 
		 			includeInLayout="{Components.instance.session.bruker.rettigheter.importerDatabase}" 
		 			label="Last opp .DAT" click="visLastOpp()" styleName="UnderMeny" 
		 			icon="@Embed(source='/no/airdog/view/assets/ikoner/envelope__plus.png')"/>
		 		<mx:LinkButton 
		 			visible="{Components.instance.session.bruker.rettigheter.leggInnJaktprove}" 
		 			includeInLayout="{Components.instance.session.bruker.rettigheter.leggInnJaktprove}" 
		 			label="Legg inn jaktprøve" click="leggInnJaktprove()" styleName="UnderMeny" 
		 			icon="@Embed(source='/no/airdog/view/assets/ikoner/report__plus.png')"/>
		 		<mx:LinkButton 
		 			visible="{Components.instance.session.bruker.rettigheter.administrereBackup}" 
		 			includeInLayout="{Components.instance.session.bruker.rettigheter.administrereBackup}" 
		 			label="Backup" click="visAdminBackup()" styleName="UnderMeny" 
		 			icon="@Embed(source='/no/airdog/view/assets/ikoner/safe.png')"/>
			</mx:HBox>
			<mx:HBox id="utviklermeny" label="Utvikling" backgroundColor="#FFFFFF" 
				borderStyle="solid" borderThickness="1" borderColor="#a3a3a3" width="100%" 
				verticalAlign="middle" paddingBottom="4" paddingTop="4" paddingLeft="4" paddingRight="4">
				<mx:LinkButton label="ACL" styleName="UnderMeny" click="visACL()" icon="@Embed(source='/no/airdog/view/assets/ikoner/key.png')"/>
			</mx:HBox>
		</mx:ViewStack>
	</mx:VBox>
	
	<mx:Spacer height="5" width="100%"/>
	
	<mx:ViewStack id="stack" width="100%" height="100%" selectedIndex="{Components.instance.session.hovedNavigasjon.nr}">
	    <adminView:DatOpplastning/>
	    <view:HundeSok/>
	    <view:HundeProfil/>
	    <adminView:RolleBruker/>
	    <adminView:RolleRettighet/>
	    <adminView:Dev_ACL/>
	    <view:Arsgjennomsnitt/>
	    <view:FiktivStamtre/>
	    <view:Hjem/>
	    <adminView:BackupVindu/>
	    <adminView:JaktproveVindu/>
	</mx:ViewStack>
</mx:VBox>